<html>
<head>
    <meta charset="UTF-8">
    <meta name="viewport"
          content="width=device-width, user-scalable=no, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>Headless static site</title>
</head>
<body>
    <ul>
        <li>
            <a href="/explorer">Explorer</a>
        </li>
    </ul>
    <h3>Index</h3>
    <div id="list"></div>


    <script type="module">
        import { create } from '/client.ts';

        const helper = create(`${window.location.origin}`);

        const index = await helper.getSitemap();
        const editable = await helper.getEditable();
        const $list = document.getElementById('list');

        if (index) {
            const $ul = document.createElement('ul');

            for (const [item, obj] of Object.entries(index)) {
                if (obj.type === 'Collection') {
                    const $li = document.createElement('li');
                    $li.innerText = item;
                    $ul.appendChild($li);
                    continue;
                }

                const overrides = obj.source.overrides;

                const $li = document.createElement('li');
                $li.innerHTML = `
                    ${obj.label || item}
                    <a href="/clover/${item}">[view]</a>
                    ${overrides ? `<a href="/editor/${item}#copy">[save copy]</a>` : ''}
                    ${editable[item] ? `<a href="/editor/${item}">[edit]</a>` : ''}
                `;

                // const $a = document.createElement('a');
                // $a.setAttribute('href', `/editor/${item}`);
                // $a.innerText = item;
                $ul.appendChild($li);
            }

            $list.innerHTML = '';
            $list.appendChild($ul);
        }
    </script>

</body>
</html>
